<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜建筑 - 建筑规范一站式查询</title>
    <link rel="icon" href="favicon.png" type="image/png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts: Noto Sans SC (Free & Open Source) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        /* 全局字体设置为 Noto Sans SC，这是 Google 提供的免费商用字体 */
        body {
            font-family: 'Noto Sans SC', sans-serif !important;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 antialiased min-h-screen font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Initial Data ---
        const DEFAULT_CATEGORIES = [
            {
                id: 1,
                title: "通用规范",
                sites: [
                    { id: 's1', name: '工程结构通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=495' },
                    { id: 's2', name: '建筑与市政工程抗震通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=494' },
                    { id: 's3', name: '建筑与市政地基基础通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1085' },
                    { id: 's4', name: '建筑与市政工程防水通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2268' },
                    { id: 's5', name: '砌体结构通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=487' },
                    { id: 's6', name: '既有建筑维护与改造通用规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=505' }
                ]
            },
            {
                id: 2,
                title: "抗震规范",
                sites: [
                    { id: 's7', name: '建筑抗震设计标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=272' },
                    { id: 's8', name: '高层建筑混凝土结构技术规程', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=230' },
                    { id: 's9', name: '建筑工程抗震设防分类标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=241' }
                ]
            },
            {
                id: 3,
                title: "地基基础",
                sites: [
                    { id: 's10', name: '建筑地基基础设计规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=236' },
                    { id: 's11', name: '建筑桩基技术规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=281' },
                    { id: 's12', name: '建筑基桩检测技术规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=566' }
                ]
            },
            {
                id: 4,
                title: "其他规范",
                sites: [
                    { id: 's13', name: '混凝土结构设计标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=234' },
                    { id: 's14', name: '地下工程防水技术规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=220' },
                    { id: 's15', name: '混凝土结构后锚固技术规程', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1265' },
                    { id: 's16', name: '混凝土结构加固设计规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=738' },
                    { id: 's17', name: '建筑基坑支护技术规程', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=663' },
                    { id: 's18', name: '建筑基坑工程监测技术标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=692' },
                    { id: 's19', name: '钢结构设计标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=440' },
                    { id: 's20', name: '建筑结构可靠性设计统一标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=448' },
                    { id: 's21', name: '岩土锚杆与喷射混凝土支护工程技术规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1125' },
                    { id: 's22', name: '人民防空地下室设计规范', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=233' },
                    { id: 's23', name: '建筑工程抗浮技术标准', url: 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2631' }
                ]
            }
        ];

        // --- 预置规范目录数据（从Excel转换） ---
        const CATALOG_DATA = [{ "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2644", "name": "《住宅项目规范》GB55038-2025", "updateTime": "更新时间：2025-07-05", "implementTime": "实施时间：2025-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2295", "name": "《建筑防火通用规范》GB 55037-2022", "updateTime": "更新时间：2025-06-28", "implementTime": "实施时间：2023-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=323", "name": "防火规范,《建筑设计防火规范》GB 50016-2014 （2018年版）", "updateTime": "更新时间：2025-08-28", "implementTime": "实施时间：2018-03-30" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2245", "name": "《钢结构通用规范》GB 55006-2021", "updateTime": "更新时间：2024-08-30", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=386", "name": "《民用建筑设计统一标准》GB 50352-2019", "updateTime": "更新时间：2024-07-05", "implementTime": "实施时间：2019-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=508", "name": "《工程结构通用规范》GB 55001-2021", "updateTime": "更新时间：2024-07-04", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=212", "name": "《建筑给水排水设计标准》GB 50015-2019", "updateTime": "更新时间：2024-06-28", "implementTime": "实施时间：2020-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2268", "name": "《建筑与市政工程防水通用规范》GB 55030-2022", "updateTime": "更新时间：2024-06-26", "implementTime": "实施时间：2023-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=509", "name": "《砌体结构通用规范》GB 55007-2021", "updateTime": "更新时间：2024-06-26", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2242", "name": "《混凝土结构通用规范》GB 55008-2021", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2022-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=503", "name": "《建筑与市政工程抗震通用规范》GB 55002-2021", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=330", "name": "《建筑地基基础设计规范》GB 50007-2011", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2012-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=362", "name": "《无障碍设计规范》 GB 50763-2012", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2012-09-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=222", "name": "《地下工程防水技术规范》 GB 50108-2008", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2009-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=233", "name": "《人民防空地下室设计规范》GB 50038-2005（2023修订版）", "updateTime": "更新时间：2024-06-25", "implementTime": "实施时间：2006-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=35", "name": "《人民防空工程设计防火规范》GB 50098-2009", "updateTime": "更新时间：2025-01-08", "implementTime": "实施时间：2009-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1", "name": "《车库建筑设计规范》JGJ 100-2015", "updateTime": "更新时间：2025-01-11", "implementTime": "实施时间：2015-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=258", "name": "《汽车库、修车库、停车场设计防火规范》 GB 50067-2014", "updateTime": "更新时间：2025-08-28", "implementTime": "实施时间：2015-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=13", "name": "《住宅设计规范》GB 50096-2011", "updateTime": "更新时间：2025-05-17", "implementTime": "实施时间：2012-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=402", "name": "《办公建筑设计标准》JGJ/T 67-2019", "updateTime": "更新时间：2025-02-25", "implementTime": "实施时间：2020-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=297", "name": "《托儿所、幼儿园建筑设计规范》JGJ 39-2016（2019年版）", "updateTime": "更新时间：2023-08-30", "implementTime": "实施时间：2016-11-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=221", "name": "《商店建筑设计规范》JGJ 48-2014", "updateTime": "更新时间：2023-10-11", "implementTime": "实施时间：2014-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=9", "name": "《综合医院建筑设计规范》 GB 51039-2014", "updateTime": "更新时间：2025-05-21", "implementTime": "实施时间：2025-02-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=215", "name": "《中小学校设计规范》GB50099-2011", "updateTime": "更新时间：2025-02-18", "implementTime": "实施时间：2012-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=934", "name": "《宿舍、旅馆建筑项目规范》GB 55025-2022", "updateTime": "更新时间：2023-03-11", "implementTime": "实施时间：2022-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=218", "name": "《旅馆建筑设计规范》JGJ62-2014", "updateTime": "更新时间：2022-10-14", "implementTime": "实施时间：2015-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=406", "name": "《宿舍建筑设计规范》JGJ 36-2016", "updateTime": "更新时间：2025-01-23", "implementTime": "实施时间：2017-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=630", "name": "《物流建筑设计规范[附条文说明]》GB 51157-2016", "updateTime": "更新时间：2022-04-22", "implementTime": "实施时间：2016-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=268", "name": "《体育建筑设计规范 JGJ31-2003》", "updateTime": "更新时间：2024-04-19", "implementTime": "实施时间：2003-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=267", "name": "《博物馆建筑设计规范》JGJ 66-2015", "updateTime": "更新时间：2016-09-01", "implementTime": "实施时间：2016-02-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=506", "name": "《消防设施通用规范》GB 55036-2022", "updateTime": "更新时间：2024-06-21", "implementTime": "实施时间：2023-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2246", "name": "《组合结构通用规范》GB 55004-2021", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=495", "name": "《建筑与市政地基基础通用规范》GB 55003-2021", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=493", "name": "《木结构通用规范》GB 55005-2021", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=234", "name": "《混凝土结构设计规范》GB 50010-2010（2015年版）", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2015-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=363", "name": "《建筑桩基技术规范》JGJ 94-2008", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2008-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=328", "name": "《砌体结构设计规范》GB 50003-2011", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2012-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=272", "name": "《建筑抗震设计规范》 GB 50011-2010（2016年版）", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2016-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=440", "name": "《钢结构设计标准》GB 50017-2017", "updateTime": "更新时间：2024-06-20", "implementTime": "实施时间：2018-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1085", "name": "《建筑电气与智能化通用规范》GB 55024-2022", "updateTime": "更新时间：2024-04-18", "implementTime": "实施时间：2023-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2250", "name": "《城市轨道交通工程项目规范》GB 55033-2022", "updateTime": "更新时间：2024-03-27", "implementTime": "实施时间：2023-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=229", "name": "《建筑结构荷载规范》GB 50009-2012", "updateTime": "更新时间：2024-03-26", "implementTime": "实施时间：2012-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=505", "name": "《既有建筑维护与改造通用规范》GB 55022-2021", "updateTime": "更新时间：2024-03-19", "implementTime": "实施时间：2022-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2247", "name": "《城乡给水工程项目规范》GB 55026-2022", "updateTime": "更新时间：2024-02-27", "implementTime": "实施时间：2023-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=219", "name": "《公共建筑节能设计标准》GB50189-2015", "updateTime": "更新时间：2024-02-04", "implementTime": "实施时间：2015-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=220", "name": "《建筑内部装修设计防火规范》GB 50222-2017", "updateTime": "更新时间：2024-01-02", "implementTime": "实施时间：2018-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=269", "name": "《建筑工程施工质量验收统一标准》GB 50300-2013", "updateTime": "更新时间：2024-01-02", "implementTime": "实施时间：2014-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=230", "name": "《高层民用建筑钢结构技术规程》JGJ 99-2015_2016全文制作，带书签_2018.05.07", "updateTime": "更新时间：2023-11-14", "implementTime": "实施时间：2016-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=241", "name": "《建筑工程抗震设防分类标准》GB 50223-2008", "updateTime": "更新时间：2023-11-10", "implementTime": "实施时间：2008-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=274", "name": "《人民防空工程施工及验收规范》GB 50134-2004", "updateTime": "更新时间：2023-10-20", "implementTime": "实施时间：2004-11-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=278", "name": "《高层建筑混凝土结构技术规程》JGJ 3-2010", "updateTime": "更新时间：2023-10-17", "implementTime": "实施时间：2011-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=224", "name": "《外墙外保温工程技术标准》JGJ 144-2019", "updateTime": "更新时间：2023-10-16", "implementTime": "实施时间：2019-11-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=280", "name": "《屋面工程质量验收规范》GB 50207-2012", "updateTime": "更新时间：2023-10-14", "implementTime": "实施时间：2012-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=663", "name": "《建筑基坑支护技术规程》 JGJ 120-2012", "updateTime": "更新时间：2023-10-12", "implementTime": "实施时间：2012-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=236", "name": "《建筑地基处理技术规范》 JGJ 79-2012", "updateTime": "更新时间：2023-09-26", "implementTime": "实施时间：201-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=448", "name": "《建筑结构可靠性设计统一标准》GB 50068-2018", "updateTime": "更新时间：2023-09-05", "implementTime": "实施时间：2019-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=738", "name": "《混凝土结构加固设计规范》GB 50367-2013", "updateTime": "更新时间：2023-09-05", "implementTime": "实施时间：2014-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=281", "name": "《建筑工程设计文件编制深度规定》（2016版）", "updateTime": "更新时间：2023-08-31", "implementTime": "实施时间：2016-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=249", "name": "《建筑幕墙》GB/T 21086-2007", "updateTime": "更新时间：2023-08-16", "implementTime": "实施时间：2008-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=254", "name": "《高层民用建筑设计防火规范》GB 50045-95(2005年版)", "updateTime": "更新时间：2023-08-15", "implementTime": "实施时间：1995-11-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1267", "name": "《建筑与市政工程施工质量控制通用规范》GB 55032-2022", "updateTime": "更新时间：2023-06-14", "implementTime": "实施时间：2023-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=566", "name": "《建筑基桩检测技术规范》JGJ 106-2014", "updateTime": "更新时间：2023-06-09", "implementTime": "实施时间：2014-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1125", "name": "《岩土锚杆与喷射混凝土支护工程技术规范》 GB 50086-2015", "updateTime": "更新时间：2023-06-08", "implementTime": "实施时间：2016-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2631", "name": "《建筑工程抗浮技术标准》JGJ476-2019", "updateTime": "更新时间：2023-05-12", "implementTime": "实施时间：2019-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=692", "name": "《建筑基坑工程监测技术标准》GB50497-2019", "updateTime": "更新时间：2023-05-12", "implementTime": "实施时间：2019-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1265", "name": "《混凝土结构后锚固技术规程》JGJ145-2013", "updateTime": "更新时间：2023-05-09", "implementTime": "实施时间：2013-09-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1262", "name": "《混凝土结构设计规范》GB 50010-2010(2024年版)", "updateTime": "更新时间：2024-06-19", "implementTime": "实施时间：2024-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=2278", "name": "《民用建筑通用规范》GB 55031-2022", "updateTime": "更新时间：2023-04-11", "implementTime": "实施时间：2023-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1084", "name": "《建筑给水排水与节水通用规范》GB 55020-2021", "updateTime": "更新时间：2023-03-20", "implementTime": "实施时间：2022-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=276", "name": "《岩土工程勘察规范》GB 50021-2001（2009年版）", "updateTime": "更新时间：2023-02-28", "implementTime": "实施时间：2009-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1087", "name": "《城市轨道交通工程测量规范》GB 50308-2017", "updateTime": "更新时间：2022-12-21", "implementTime": "实施时间：2018-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=282", "name": "《疏散干道与主要出入口》【人民防空工程设计防火规范】GB50098-09", "updateTime": "更新时间：2022-10-25", "implementTime": "实施时间：2009-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1088", "name": "《城市轨道交通结构安全保护技术规范》CJJ/T 202-2013", "updateTime": "更新时间：2022-09-15", "implementTime": "实施时间：2013-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1090", "name": "《地下结构抗震设计标准》GB/T 51336-2018", "updateTime": "更新时间：2022-09-15", "implementTime": "实施时间：2019-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1089", "name": "《地铁设计规范》GB 50157-2013", "updateTime": "更新时间：2022-09-15", "implementTime": "实施时间：2014-02-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1086", "name": "《城市轨道交通桥梁设计规范》CJJ 243-2016", "updateTime": "更新时间：2022-09-15", "implementTime": "实施时间：2016-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=277", "name": "《建筑地基基础工程施工质量验收标准》GB 50202-2018", "updateTime": "更新时间：2022-06-23", "implementTime": "实施时间：2018-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=1091", "name": "《盾构法隧道施工及验收规范》GB 50446-2017", "updateTime": "更新时间：2022-05-27", "implementTime": "实施时间：2017-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=296", "name": "《汽车加油加气加氢站技术标准》GB 50156-2021", "updateTime": "更新时间：2022-04-08", "implementTime": "实施时间：2021-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=329", "name": "《门式钢架轻型房屋钢结构技术规范》GB 51022-2015", "updateTime": "更新时间：2022-03-21", "implementTime": "实施时间：2015-09-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=336", "name": "《冷弯薄壁型钢结构技术规范》GB 50018-2002", "updateTime": "更新时间：2022-03-21", "implementTime": "实施时间：2003-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=225", "name": "《屋面工程技术规范》GB 50345-2012", "updateTime": "更新时间：2022-03-10", "implementTime": "实施时间：2013-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=240", "name": "《多层和高层钢结构住宅技术标准》JGJ/T 469-2019", "updateTime": "更新时间：2022-01-18", "implementTime": "实施时间：2019-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=279", "name": "《民用建筑热工设计规范》GB 50176-2016", "updateTime": "更新时间：2021-12-28", "implementTime": "实施时间：2017-04-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=271", "name": "《建筑地基基础设计规范》DB11/401-2015", "updateTime": "更新时间：2021-11-22", "implementTime": "实施时间：2016-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=332", "name": "《城市地下综合管廊工程技术规范》 GB 50838-2015", "updateTime": "更新时间：2021-11-16", "implementTime": "实施时间：2015-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=358", "name": "《住宅室内防水工程技术规范》JGJ 298-2013", "updateTime": "更新时间：2021-11-01", "implementTime": "实施时间：2014-02-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=213", "name": "《建筑工程建筑面积计算规范》（带条文）GB/T50353-2013", "updateTime": "更新时间：2021-10-14", "implementTime": "实施时间：2014-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=340", "name": "《汽车库建筑设计规范》JGJ100-2015", "updateTime": "更新时间：2021-10-11", "implementTime": "实施时间：2015-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=501", "name": "《绿色建筑评价标准》GB/T 50378-2019", "updateTime": "更新时间：2021-09-28", "implementTime": "实施时间：2019-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=353", "name": "《工程岩体试验方法标准》GB/T 50266-2013", "updateTime": "更新时间：2021-09-15", "implementTime": "实施时间：2013-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=354", "name": "《岩土工程勘察安全规范》GB 50585-2010", "updateTime": "更新时间：2021-09-15", "implementTime": "实施时间：2010-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=341", "name": "《装配式混凝土建筑技术标准》 GB T 51231-2016", "updateTime": "更新时间：2021-09-14", "implementTime": "实施时间：2017-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=275", "name": "《城镇燃气设计规范》 GB 50028-2006（2020年版）", "updateTime": "更新时间：2021-09-03", "implementTime": "实施时间：2021-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=244", "name": "《城市综合管廊工程技术规范》 GB 50838-2015", "updateTime": "更新时间：2021-08-30", "implementTime": "实施时间：2015-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=250", "name": "《城市桥梁抗震设计规范》CJJ 166-2011", "updateTime": "更新时间：2021-08-23", "implementTime": "实施时间：2011-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=273", "name": "《混凝土结构工程施工质量验收规范》GB50204-2015", "updateTime": "更新时间：2021-08-20", "implementTime": "实施时间：2015-09-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=245", "name": "《电动汽车分散充电设施工程技术标准》GB/T51313-2018", "updateTime": "更新时间：2021-08-16", "implementTime": "实施时间：2018-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=457", "name": "《综合医院建筑设计规范》（征求意见稿）", "updateTime": "更新时间：2021-08-05", "implementTime": "实施时间：1950-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=452", "name": "《建筑工程设计信息模型制图标准》JGJ/T 448-2018", "updateTime": "更新时间：2021-07-22", "implementTime": "实施时间：2018-09-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=455", "name": "《建筑建模信息分类和编码标准（统一标准）》GB/T 51269-2017", "updateTime": "更新时间：2021-07-20", "implementTime": "实施时间：2018-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=456", "name": "《建筑信息模型设计交付标准》GB/T 51301-2018", "updateTime": "更新时间：2021-07-20", "implementTime": "实施时间：2019-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=451", "name": "《建设项目工程总承包管理规范》 GB/T 50358-2017", "updateTime": "更新时间：2021-07-19", "implementTime": "实施时间：2018-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=458", "name": "《既有建筑鉴定与加固通用规范（草案）》GB55021-2021", "updateTime": "更新时间：2021-07-16", "implementTime": "实施时间：2022-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=460", "name": "《电影院建筑设计规范[附条文说明] GB50516-2010（2021年版）", "updateTime": "更新时间：2021-07-16", "implementTime": "实施时间：2021-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=453", "name": "《居住建筑节能设计标准(节能 75%)(2021年版)》DB13(J)185-2020", "updateTime": "更新时间：2021-07-05", "implementTime": "实施时间：" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=463", "name": "《传染病医院建筑设计规范》GB 50849-2014", "updateTime": "更新时间：2021-05-14", "implementTime": "实施时间：2015-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=454", "name": "《锅炉房设计标准》GB 50041-2020", "updateTime": "更新时间：2021-03-01", "implementTime": "实施时间：2020-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=459", "name": "《建筑用木塑复合板应用技术标准》JGJ/T478-2019", "updateTime": "更新时间：2021-02-23", "implementTime": "实施时间：2020-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=327", "name": "《房屋建筑制图统一标准》GB/T 50001-2017", "updateTime": "更新时间：2020-12-17", "implementTime": "实施时间：2011-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=359", "name": "《自流平地面工程技术标准》JGJ／T 175-2018", "updateTime": "更新时间：2020-12-16", "implementTime": "实施时间：2018-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=360", "name": "《工业建筑节能设计统一标准》GB 51245-2017", "updateTime": "更新时间：2020-12-15", "implementTime": "实施时间：2018-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=395", "name": "《疗养院建筑设计标准》JGJ/T40-2019", "updateTime": "更新时间：2020-12-15", "implementTime": "实施时间：2019-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=423", "name": "《公墓和骨灰寄存建筑设计规范》 JGJ/T 397-2016", "updateTime": "更新时间：2020-12-14", "implementTime": "实施时间：2017-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=424", "name": "《医院洁净手术部建筑技术规范》 GB 50333-2013", "updateTime": "更新时间：2020-12-14", "implementTime": "实施时间：2014-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=435", "name": "《城镇商住公寓建筑设计规程》（征求意见稿）", "updateTime": "更新时间：2020-11-26", "implementTime": "实施时间：2019-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=415", "name": "《装配式混凝土建筑技术标准》GB/T 51231-2016", "updateTime": "更新时间：2020-11-26", "implementTime": "实施时间：2017-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=413", "name": "《装配式钢结构建筑技术标准》 GB/T 51232-2016", "updateTime": "更新时间：2020-11-26", "implementTime": "实施时间：2017-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=335", "name": "《建筑门窗玻璃幕墙热工计算规程》JGJ/T 151-2008", "updateTime": "更新时间：2020-11-26", "implementTime": "实施时间：2009-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=405", "name": "《康复医院建筑设计标准（征求意见稿）》", "updateTime": "更新时间：2020-11-25", "implementTime": "实施时间：2020-04-07" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=426", "name": "《建筑信息模型分类和编码标准》 GB/T 51269-2017", "updateTime": "更新时间：2020-11-25", "implementTime": "实施时间：2018-05-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=431", "name": "《建筑信息模型应用统一标准》GB／T 51212-2016", "updateTime": "更新时间：2020-11-25", "implementTime": "实施时间：2017-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=432", "name": "《建筑信息模型施工应用标准》GB／T 51235-2017", "updateTime": "更新时间：2020-11-25", "implementTime": "实施时间：2018-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=334", "name": "《多高层木结构建筑技术标准》GB/T 51226-2017", "updateTime": "更新时间：2020-11-20", "implementTime": "实施时间：2017-10-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=416", "name": "《印染工厂设计规范》GB 50426-2016", "updateTime": "更新时间：2020-11-17", "implementTime": "实施时间：2017-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=414", "name": "《装配式木结构建筑技术标准》GB/T 51233-2016", "updateTime": "更新时间：2020-11-16", "implementTime": "实施时间：2017-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=444", "name": "《水泥工厂设计规范》GB 50295-2016", "updateTime": "更新时间：2020-11-10", "implementTime": "实施时间：" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=332", "name": "《装配式住宅建筑设计标准》JGJ／T 398-2017", "updateTime": "更新时间：2020-11-05", "implementTime": "实施时间：2018-06-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=446", "name": "《传统建筑工程技术标准》GB/T51330-2019", "updateTime": "更新时间：2020-11-05", "implementTime": "实施时间：" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=437", "name": "《装配式整体厨房应用技术标准》JGJ/T 477-2018", "updateTime": "更新时间：2020-09-10", "implementTime": "实施时间：2019-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=428", "name": "《特殊教育学校建筑设计标准》JGJ 76-2019", "updateTime": "更新时间：2020-07-09", "implementTime": "实施时间：2020-03-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=399", "name": "《装配式混凝土建筑技术体系发展指南（居住建筑）》2019", "updateTime": "更新时间：2019-11-08", "implementTime": "实施时间：2019-07-04" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=351", "name": "《工业建筑防腐蚀设计规范》GB 50046-2008", "updateTime": "更新时间：2018-11-30", "implementTime": "实施时间：2008-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=325", "name": "《全国民用建筑工程设计技术措施-结构（砌体结构）》（2009年版）", "updateTime": "更新时间：2018-07-28", "implementTime": "实施时间：" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=304", "name": "《精神专科医院建筑设计规范》GB 51058-2014", "updateTime": "更新时间：2016-12-22", "implementTime": "实施时间：2015-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=303", "name": "《医药工业总图运输设计规范》GB 51047-2014", "updateTime": "更新时间：2016-12-21", "implementTime": "实施时间：2015-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=298", "name": "《疗养院建筑设计规范》（征求意见稿）", "updateTime": "更新时间：2016-11-25", "implementTime": "实施时间：1988-01-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=265", "name": "《铁路旅客车站建筑设计规范》GB 50226-2007（2011版）", "updateTime": "更新时间：2016-09-01", "implementTime": "实施时间：2007-12-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=259", "name": "《电影院建筑设计规范》JGJ 582008", "updateTime": "更新时间：2016-08-16", "implementTime": "实施时间：2008-08-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=31", "name": "《建筑工程建筑面积计算规范》GB/T 50353-2013", "updateTime": "更新时间：2016-07-04", "implementTime": "实施时间：2014-07-01" }, { "url": "https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=22", "name": "《2007全国民用建筑工程设计技术措施》节能专篇", "updateTime": "更新时间：2015-05-18", "implementTime": "实施时间：2007-01-01" }];

        // --- Catalog Viewer Modal ---
        const CatalogViewerModal = ({ isOpen, onClose, categories, onAddToCategory }) => {
            const [tableData, setTableData] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedRows, setSelectedRows] = useState(new Set());
            const [showCategorySelector, setShowCategorySelector] = useState(false);

            // 组件打开时自动加载预置数据
            useEffect(() => {
                if (isOpen && tableData.length === 0) {
                    setTableData(CATALOG_DATA);
                }
            }, [isOpen]);

            // 上传Excel文件的功能（保留）
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary' });
                        const wsname = wb.SheetNames[0];
                        const ws = wb.Sheets[wsname];
                        const data = XLSX.utils.sheet_to_json(ws);
                        // 转换为标准格式
                        const converted = data.map(row => ({
                            url: row['网址'] || row.url || '',
                            name: row['名称'] || row.name || '',
                            updateTime: row['更新时间'] || row.updateTime || '',
                            implementTime: row['实施时间'] || row.implementTime || ''
                        }));
                        setTableData(converted);
                        setSelectedRows(new Set());
                    } catch (error) {
                        console.error("Error parsing file:", error);
                        alert("文件解析失败，请确保上传的是有效的 Excel 文件。");
                    }
                };
                reader.readAsBinaryString(file);
            };

            // 搜索过滤
            const filteredData = useMemo(() => {
                if (!searchQuery.trim()) return tableData;
                const lowerQuery = searchQuery.toLowerCase();
                return tableData.filter(item =>
                    item.name.toLowerCase().includes(lowerQuery) ||
                    item.url.toLowerCase().includes(lowerQuery)
                );
            }, [tableData, searchQuery]);

            // 全选/取消全选
            const handleSelectAll = (e) => {
                if (e.target.checked) {
                    const allIds = new Set(filteredData.map((_, idx) => idx));
                    setSelectedRows(allIds);
                } else {
                    setSelectedRows(new Set());
                }
            };

            // 单选
            const handleSelectRow = (idx) => {
                const newSelected = new Set(selectedRows);
                if (newSelected.has(idx)) {
                    newSelected.delete(idx);
                } else {
                    newSelected.add(idx);
                }
                setSelectedRows(newSelected);
            };

            // 添加到分类
            const handleAddToCategory = (categoryId) => {
                const selected = filteredData.filter((_, idx) => selectedRows.has(idx));
                if (selected.length === 0) {
                    alert('请先勾选要添加的规范');
                    return;
                }

                onAddToCategory(categoryId, selected);
                setSelectedRows(new Set());
                setShowCategorySelector(false);
                alert(`成功添加 ${selected.length} 个规范到分类`);
            };

            // 下载Excel模板
            const downloadTemplate = () => {
                // 创建示例数据
                const templateData = [
                    {
                        '网址': 'https://www.soujianzhu.cn/NormAndRules/NormContent.aspx?id=xxx',
                        '名称': '《示例规范名称》GB XXXXX-XXXX',
                        '更新时间': '更新时间：2025-01-01',
                        '实施时间': '实施时间：2025-03-01'
                    }
                ];

                // 创建工作簿
                const ws = XLSX.utils.json_to_sheet(templateData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "规范目录");

                // 下载文件
                XLSX.writeFile(wb, "规范目录模板.xlsx");
            };

            // 上传本地PDF文件
            const handlePdfUpload = (e) => {
                const files = e.target.files;
                if (!files || files.length === 0) return;

                const newPdfItems = [];
                Array.from(files).forEach(file => {
                    if (file.type === 'application/pdf') {
                        // 创建blob URL用于在浏览器中直接查看PDF
                        const pdfUrl = URL.createObjectURL(file);
                        const fileName = file.name.replace('.pdf', '').replace('.PDF', '');

                        newPdfItems.push({
                            url: pdfUrl, // blob URL
                            name: fileName,
                            updateTime: `上传时间：${new Date().toLocaleDateString()}`,
                            implementTime: '本地PDF',
                            pdfUrl: pdfUrl, // 标记为PDF文件
                            isLocalPdf: true
                        });
                    }
                });

                if (newPdfItems.length > 0) {
                    setTableData(prev => [...newPdfItems, ...prev]);
                    alert(`成功上传 ${newPdfItems.length} 个PDF文件，已添加到规范目录列表顶部`);
                }

                // 清空input以支持重复上传同名文件
                e.target.value = '';
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn">
                    <div className="bg-white w-full max-w-6xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-slate-200">
                        {/* Header */}
                        <div className="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                            <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <i className="fa-solid fa-table-list text-blue-600"></i>
                                规范目录库 ({tableData.length} 条)
                            </h3>
                            <button onClick={onClose} className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 text-slate-500 transition-colors">
                                <i className="fa-solid fa-xmark"></i>
                            </button>
                        </div>

                        {/* Toolbar */}
                        <div className="p-4 bg-white border-b border-slate-100 flex flex-col sm:flex-row gap-4 items-center">
                            <div className="flex gap-2 flex-wrap">
                                <label className="flex items-center gap-2 px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg cursor-pointer transition-colors shadow-sm font-medium text-sm">
                                    <i className="fa-solid fa-upload"></i>
                                    上传Excel
                                    <input type="file" accept=".xlsx, .xls" onChange={handleFileUpload} className="hidden" />
                                </label>

                                <button
                                    onClick={downloadTemplate}
                                    className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors shadow-sm font-medium text-sm"
                                    title="下载Excel模板，按模板格式填写后上传"
                                >
                                    <i className="fa-solid fa-download"></i>
                                    下载模板
                                </button>

                                <label className="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg cursor-pointer transition-colors shadow-sm font-medium text-sm"
                                    title="上传本地PDF文件，可直接在浏览器中查看"
                                >
                                    <i className="fa-solid fa-file-pdf"></i>
                                    上传PDF
                                    <input type="file" accept=".pdf" multiple onChange={handlePdfUpload} className="hidden" />
                                </label>

                                {selectedRows.size > 0 && (
                                    <button
                                        onClick={() => setShowCategorySelector(!showCategorySelector)}
                                        className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm font-medium text-sm"
                                    >
                                        <i className="fa-solid fa-plus"></i>
                                        添加到分类 ({selectedRows.size})
                                    </button>
                                )}
                            </div>

                            <div className="flex-1 w-full relative">
                                <i className="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input
                                    type="text"
                                    placeholder="搜索规范名称或网址..."
                                    className="w-full pl-10 pr-4 py-2 bg-slate-100 border-none rounded-lg focus:ring-2 focus:ring-blue-200 text-slate-700 outline-none"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* Category Selector */}
                        {showCategorySelector && (
                            <div className="bg-blue-50 p-3 border-b border-blue-100">
                                <div className="flex items-center gap-2 flex-wrap">
                                    <span className="text-sm font-medium text-slate-700">选择目标分类：</span>
                                    {categories.map(cat => (
                                        <button
                                            key={cat.id}
                                            onClick={() => handleAddToCategory(cat.id)}
                                            className="px-3 py-1 bg-white hover:bg-blue-100 border border-blue-200 rounded-lg text-sm text-slate-700 transition-colors"
                                        >
                                            {cat.title}
                                        </button>
                                    ))}
                                    <button
                                        onClick={() => setShowCategorySelector(false)}
                                        className="ml-auto px-3 py-1 bg-slate-200 hover:bg-slate-300 rounded-lg text-sm text-slate-600"
                                    >
                                        取消
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Table */}
                        <div className="flex-1 overflow-auto bg-slate-50">
                            {tableData.length > 0 ? (
                                <table className="w-full text-left border-collapse">
                                    <thead className="bg-slate-100 sticky top-0 z-10 shadow-sm">
                                        <tr>
                                            <th className="p-3 font-semibold text-slate-600 text-sm border-b border-slate-200 w-12">
                                                <input
                                                    type="checkbox"
                                                    onChange={handleSelectAll}
                                                    checked={filteredData.length > 0 && selectedRows.size === filteredData.length}
                                                    className="w-4 h-4 cursor-pointer"
                                                />
                                            </th>
                                            <th className="p-3 font-semibold text-slate-600 text-sm border-b border-slate-200">规范名称</th>
                                            <th className="p-3 font-semibold text-slate-600 text-sm border-b border-slate-200">更新时间</th>
                                            <th className="p-3 font-semibold text-slate-600 text-sm border-b border-slate-200">实施时间</th>
                                            <th className="p-3 font-semibold text-slate-600 text-sm border-b border-slate-200 w-20">链接</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-slate-100">
                                        {filteredData.map((item, idx) => (
                                            <tr key={idx} className={`hover:bg-blue-50 transition-colors ${selectedRows.has(idx) ? 'bg-blue-50' : ''}`}>
                                                <td className="p-3 text-center">
                                                    <input
                                                        type="checkbox"
                                                        checked={selectedRows.has(idx)}
                                                        onChange={() => handleSelectRow(idx)}
                                                        className="w-4 h-4 cursor-pointer"
                                                    />
                                                </td>
                                                <td className="p-3 text-sm text-slate-700" title={item.name}>{item.name}</td>
                                                <td className="p-3 text-sm text-slate-600">{item.updateTime}</td>
                                                <td className="p-3 text-sm text-slate-600">{item.implementTime}</td>
                                                <td className="p-3 text-center">
                                                    <a href={item.url} target="_blank" className="text-blue-600 hover:underline text-sm">
                                                        <i className="fa-solid fa-external-link"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        ))}
                                        {filteredData.length === 0 && (
                                            <tr>
                                                <td colSpan="5" className="p-8 text-center text-slate-400">
                                                    没有找到匹配的规范
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-slate-400">
                                    <i className="fa-solid fa-inbox text-4xl mb-3 text-slate-300"></i>
                                    <p className="text-lg font-medium text-slate-600">正在加载规范目录...</p>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="bg-slate-50 p-2 text-xs text-slate-400 text-center border-t">
                            显示 {filteredData.length} 条记录 {selectedRows.size > 0 && `| 已选 ${selectedRows.size} 条`}
                        </div>
                    </div>
                </div>
            );
        };

        // --- SearchBar Component ---
        const SearchBar = () => {
            const [query, setQuery] = useState('');

            const handleSearch = () => {
                if (query.trim()) {
                    window.open(`https://www.soujianzhu.cn/Search/SouGuifan.aspx?skey=${encodeURIComponent(query.trim())}`, '_blank');
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') handleSearch();
            };

            return (
                <div className="w-full max-w-2xl mx-auto mb-8 relative group z-10">
                    <div className="absolute -inset-0.5 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full opacity-30 group-hover:opacity-50 blur transition duration-200"></div>
                    <div className="relative flex items-center bg-white rounded-full shadow-md overflow-hidden p-1">
                        <input
                            type="text"
                            className="flex-1 px-6 py-3 text-slate-700 focus:outline-none placeholder-slate-400 text-lg bg-transparent"
                            placeholder="输入规范关键词搜索..."
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyDown={handleKeyDown}
                        />
                        <button
                            onClick={handleSearch}
                            className="bg-blue-600 text-white p-3 rounded-full w-12 h-12 flex items-center justify-center hover:bg-blue-700 transition-colors shadow-sm"
                        >
                            <i className="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // --- SiteCard Component ---
        const SiteCard = ({ site, isEditMode, onDelete, onEdit, categories, onMoveToCategory, isEditing, onSetEditing }) => {
            const [editName, setEditName] = useState(site.name);
            const [editUrl, setEditUrl] = useState(site.url);
            const [editPdfUrl, setEditPdfUrl] = useState(site.pdfUrl || null);
            const pdfInputRef = useRef(null);

            // 同步props变化
            useEffect(() => {
                if (isEditing) {
                    setEditName(site.name);
                    setEditUrl(site.url);
                    setEditPdfUrl(site.pdfUrl || null);
                }
            }, [site, isEditing]);

            const handleDragStart = (e) => {
                e.dataTransfer.setData("siteId", site.id);
                e.dataTransfer.effectAllowed = "move";
                e.target.classList.add('opacity-50');
            };

            const handleDragEnd = (e) => {
                e.target.classList.remove('opacity-50');
            };

            // 判断是否有本地PDF
            const hasPdf = site.pdfUrl && site.pdfUrl.startsWith('blob:');
            // 优先使用PDF链接，否则使用网页链接
            const targetUrl = hasPdf ? site.pdfUrl : site.url;

            // 保存编辑
            const handleSave = () => {
                if (editName.trim()) {
                    onEdit(site.id, {
                        name: editName.trim(),
                        url: editUrl.trim(),
                        pdfUrl: editPdfUrl
                    });
                    onSetEditing(false);
                }
            };

            // 取消编辑
            const handleCancel = () => {
                onSetEditing(false);
            };

            // 点击卡片进入编辑
            const handleCardClick = (e) => {
                if (isEditMode && !e.target.closest('.delete-btn')) {
                    e.preventDefault();
                    e.stopPropagation();
                    onSetEditing(true);
                }
            };

            // 删除规范
            const handleDeleteClick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (confirm('确定要删除这个规范吗？')) {
                    onDelete(site.id);
                }
            };

            // 上传PDF
            const handlePdfUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    const pdfUrl = URL.createObjectURL(file);
                    setEditPdfUrl(pdfUrl);
                }
                e.target.value = '';
            };

            // 删除PDF
            const handleRemovePdf = () => {
                if (editPdfUrl) {
                    URL.revokeObjectURL(editPdfUrl);
                    setEditPdfUrl(null);
                }
            };

            return (
                <>
                    <div
                        draggable={isEditMode && !isEditing}
                        onDragStart={isEditMode ? handleDragStart : undefined}
                        onDragEnd={isEditMode ? handleDragEnd : undefined}
                        onClick={handleCardClick}
                        className={`
                            relative group block p-1 bg-white border border-slate-200 rounded-lg shadow-sm 
                            hover:shadow-md hover:border-blue-300 hover:-translate-y-0.5 transition-all duration-200 
                            ${isEditMode ? 'cursor-pointer ring-2 ring-blue-200' : 'cursor-pointer'}
                            ${hasPdf ? 'border-l-4 border-l-red-500' : ''}
                        `}
                    >
                        {isEditMode && (
                            <button
                                onClick={handleDeleteClick}
                                className="delete-btn absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-md hover:bg-red-600 z-20 hover:scale-110 transition-transform"
                                title="删除此规范"
                            >
                                <i className="fa-solid fa-times"></i>
                            </button>
                        )}
                        {/* 编辑图标放在最左侧 */}
                        {isEditMode && (
                            <span className="absolute -top-1 left-1 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded shadow-sm">
                                <i className="fa-solid fa-pen text-xs"></i>
                            </span>
                        )}
                        {hasPdf && (
                            <span className="absolute -top-1 -left-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded shadow-sm font-bold">
                                PDF
                            </span>
                        )}
                        {!isEditMode ? (
                            <a
                                href={targetUrl}
                                target="_blank"
                                className="block h-full w-full text-center py-2 px-1"
                            >
                                <span className="text-sm font-bold text-slate-800 tracking-tight leading-snug group-hover:text-blue-700 transition-colors line-clamp-2">
                                    {hasPdf && <i className="fa-solid fa-file-pdf text-red-500 mr-1"></i>}
                                    {site.name}
                                </span>
                            </a>
                        ) : (
                            <div className="block h-full w-full text-center py-2 px-1">
                                <span className="text-sm font-bold text-slate-800 tracking-tight leading-snug line-clamp-2">
                                    {hasPdf && <i className="fa-solid fa-file-pdf text-red-500 mr-1"></i>}
                                    {site.name}
                                </span>
                            </div>
                        )}
                    </div>

                    {/* 编辑弹窗 - 使用 Portal 渲染到 body 解决遮挡问题 */}
                    {isEditing && ReactDOM.createPortal(
                        <div className="fixed inset-0 z-[99999] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fadeIn" onClick={handleCancel}>
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto transform transition-all scale-100" onClick={e => e.stopPropagation()}>
                                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                    <i className="fa-solid fa-pen-to-square text-blue-600"></i>
                                    编辑规范
                                </h3>
                                <div className="space-y-4">
                                    {/* 规范名称 */}
                                    <div>
                                        <label className="block text-sm font-medium text-slate-600 mb-1">
                                            <i className="fa-solid fa-tag mr-1 text-blue-500"></i>规范名称
                                        </label>
                                        <input
                                            type="text"
                                            value={editName}
                                            onChange={(e) => setEditName(e.target.value)}
                                            className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 outline-none"
                                            autoFocus
                                        />
                                    </div>

                                    {/* 链接地址 */}
                                    <div>
                                        <label className="block text-sm font-medium text-slate-600 mb-1">
                                            <i className="fa-solid fa-link mr-1 text-green-500"></i>链接地址
                                        </label>
                                        <input
                                            type="text"
                                            value={editUrl}
                                            onChange={(e) => setEditUrl(e.target.value)}
                                            className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 outline-none font-mono text-sm"
                                            placeholder="https://..."
                                        />
                                    </div>

                                    {/* PDF文件 */}
                                    <div>
                                        <label className="block text-sm font-medium text-slate-600 mb-1">
                                            <i className="fa-solid fa-file-pdf mr-1 text-red-500"></i>本地PDF文件
                                            <span className="text-xs text-slate-400 ml-2 font-normal">(上传后将优先显示PDF内容)</span>
                                        </label>
                                        {editPdfUrl ? (
                                            <div className="flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg">
                                                <i className="fa-solid fa-file-pdf text-red-500 text-xl"></i>
                                                <div className="flex-1 min-w-0">
                                                    <div className="text-sm text-slate-700 truncate font-medium">已上传PDF文件</div>
                                                    <div className="text-xs text-slate-500">点击卡片将直接预览此PDF</div>
                                                </div>
                                                <a href={editPdfUrl} target="_blank" className="text-blue-600 hover:underline text-sm whitespace-nowrap px-2">
                                                    <i className="fa-solid fa-eye mr-1"></i>预览
                                                </a>
                                                <button
                                                    onClick={handleRemovePdf}
                                                    className="text-red-600 hover:text-red-700 text-sm whitespace-nowrap px-2"
                                                >
                                                    <i className="fa-solid fa-trash mr-1"></i>删除
                                                </button>
                                            </div>
                                        ) : (
                                            <label className="flex flex-col items-center justify-center gap-2 p-6 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:border-red-400 hover:bg-red-50 transition-colors group/upload">
                                                <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center group-hover/upload:bg-red-100 transition-colors">
                                                    <i className="fa-solid fa-upload text-slate-400 group-hover/upload:text-red-500"></i>
                                                </div>
                                                <span className="text-slate-600 font-medium group-hover/upload:text-red-600">点击上传PDF文件</span>
                                                <span className="text-xs text-slate-400">支持 .pdf 格式，上传后可直接预览</span>
                                                <input
                                                    ref={pdfInputRef}
                                                    type="file"
                                                    accept=".pdf"
                                                    onChange={handlePdfUpload}
                                                    className="hidden"
                                                />
                                            </label>
                                        )}
                                    </div>
                                </div>

                                {/* 底部按钮 */}
                                <div className="flex gap-3 pt-2 mt-6">
                                    <button
                                        onClick={handleSave}
                                        className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors font-medium shadow-sm active:scale-95 transform duration-100"
                                    >
                                        保存修改
                                    </button>
                                    <button
                                        onClick={handleCancel}
                                        className="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-lg transition-colors font-medium active:scale-95 transform duration-100"
                                    >
                                        取消
                                    </button>
                                </div>
                                <div className="border-t border-slate-100 mt-4 pt-4 flex justify-between items-center">
                                    <span className="text-xs text-slate-400">如果要彻底删除此规范，请点击右侧按钮</span>
                                    <button
                                        onClick={() => {
                                            if (confirm('确定要删除这个规范吗？')) {
                                                onDelete(site.id);
                                                onSetEditing(false);
                                            }
                                        }}
                                        className="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-1 text-sm font-medium"
                                        title="彻底删除此规范"
                                    >
                                        <i className="fa-solid fa-trash-can"></i>
                                        删除规范
                                    </button>
                                </div>
                            </div>
                        </div>,
                        document.body
                    )}
                </>
            );
        };

        // --- CategoryGroup Component ---
        const CategoryGroup = ({ category, onDrop, isEditMode, onDeleteSite, onEditSite, onUpdateCategoryTitle, editingSiteId, onSetEditingSiteId }) => {
            const [isEditingTitle, setIsEditingTitle] = useState(false);
            const [newTitle, setNewTitle] = useState(category.title);
            const [isCollapsed, setIsCollapsed] = useState(false);
            const [width, setWidth] = useState(null); // null = auto
            const resizeRef = useRef(null);
            const containerRef = useRef(null);

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = "move";
                e.currentTarget.classList.add('bg-blue-50');
            };

            const handleDragLeave = (e) => {
                e.currentTarget.classList.remove('bg-blue-50');
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.currentTarget.classList.remove('bg-blue-50');
                const siteId = e.dataTransfer.getData("siteId");
                if (siteId) {
                    onDrop(siteId, category.id);
                }
            };

            const saveTitle = () => {
                if (newTitle.trim()) {
                    onUpdateCategoryTitle(category.id, newTitle.trim());
                } else {
                    setNewTitle(category.title); // Revert if empty
                }
                setIsEditingTitle(false);
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') saveTitle();
            };

            return (
                <div
                    onDragOver={isEditMode ? handleDragOver : undefined}
                    onDragLeave={isEditMode ? handleDragLeave : undefined}
                    onDrop={isEditMode ? handleDrop : undefined}
                    className={`
                        glass-panel rounded-xl p-5 shadow-sm border border-slate-100 flex flex-col h-full transition-colors duration-200
                        ${isEditMode ? 'border-dashed border-2 border-slate-300' : ''}
                    `}
                >
                    <div className="mb-4 flex items-center justify-between border-b border-slate-100 pb-2">
                        <div className="flex items-center gap-2 flex-1 overflow-hidden">
                            {/* Collapse Toggle Button */}
                            <button
                                onClick={() => setIsCollapsed(!isCollapsed)}
                                className="w-6 h-6 flex-shrink-0 flex items-center justify-center rounded hover:bg-slate-100 text-slate-400 transition-colors"
                            >
                                <i className={`fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} text-sm`}></i>
                            </button>

                            {isEditMode && isEditingTitle ? (
                                <input
                                    type="text"
                                    autoFocus
                                    value={newTitle}
                                    onChange={(e) => setNewTitle(e.target.value)}
                                    onBlur={saveTitle}
                                    onKeyDown={handleKeyDown}
                                    className="font-semibold text-slate-700 text-lg bg-white border border-blue-400 rounded px-1 w-full outline-none"
                                />
                            ) : (
                                <h2
                                    className={`font-semibold text-slate-700 text-lg flex items-center gap-2 select-none flex-1 truncate
                                        ${isEditMode ? 'cursor-text hover:text-blue-600' : 'cursor-pointer'}
                                    `}
                                    onClick={() => {
                                        if (isEditMode) {
                                            setIsEditingTitle(true);
                                        } else {
                                            setIsCollapsed(!isCollapsed);
                                        }
                                    }}
                                    title={isEditMode ? "点击修改分类名称" : "点击折叠/展开分类"}
                                >
                                    <i className="fa-solid fa-folder-open text-blue-500 opacity-80 text-base"></i>
                                    {category.title}
                                    {isEditMode && <i className="fa-solid fa-pen text-xs text-slate-400 ml-1"></i>}
                                </h2>
                            )}
                        </div>
                    </div>

                    {!isCollapsed && (
                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 animate-fadeIn">
                            {category.sites.map(site => (
                                <SiteCard
                                    key={site.id}
                                    site={site}
                                    isEditMode={isEditMode}
                                    onDelete={onDeleteSite}
                                    onEdit={onEditSite}
                                    isEditing={editingSiteId === site.id}
                                    onSetEditing={(isEditing) => onSetEditingSiteId(isEditing ? site.id : null)}
                                />
                            ))}
                            {category.sites.length === 0 && (
                                <div className="col-span-full py-8 text-center text-slate-400 text-sm italic bg-slate-50 rounded-lg">
                                    {isEditMode ? "拖拽卡片到此处" : "暂无内容"}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            const [isEditMode, setIsEditMode] = useState(false);
            const [isCatalogModalOpen, setIsCatalogModalOpen] = useState(false);
            const [editingSiteId, setEditingSiteId] = useState(null); // 全局编辑状态
            const restoreInputRef = useRef(null);

            // 保存数据存档（导出JSON文件）
            const handleSaveArchive = () => {
                const archiveData = {
                    version: '1.0',
                    savedAt: new Date().toISOString(),
                    categories: categories.map(cat => ({
                        ...cat,
                        sites: cat.sites.map(site => ({
                            ...site,
                            // 不保存blob URL（本地PDF），只保存其他数据
                            pdfUrl: site.pdfUrl && site.pdfUrl.startsWith('blob:') ? null : site.pdfUrl
                        }))
                    }))
                };

                const blob = new Blob([JSON.stringify(archiveData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `搜建筑导航_存档_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('✅ 存档已保存！\n\n请妥善保管下载的JSON文件，需要时可通过"恢复存档"功能恢复数据。');
            };

            // 恢复数据存档（导入JSON文件）
            const handleRestoreArchive = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const archiveData = JSON.parse(event.target.result);

                        if (!archiveData.categories || !Array.isArray(archiveData.categories)) {
                            throw new Error('无效的存档文件格式');
                        }

                        if (confirm(`确定要恢复此存档吗？\n\n存档时间：${new Date(archiveData.savedAt).toLocaleString()}\n包含 ${archiveData.categories.length} 个分类\n\n⚠️ 当前数据将被覆盖！`)) {
                            setCategories(archiveData.categories);
                            alert('✅ 存档恢复成功！');
                        }
                    } catch (err) {
                        alert('❌ 恢复失败：文件格式无效\n\n' + err.message);
                    }
                };
                reader.readAsText(file);
                e.target.value = ''; // 清空以支持重复上传
            };

            // Handle dropping a site into a category
            const handleDropSite = (siteId, targetCategoryId) => {
                let movedSite = null;

                // 1. Find and remove site from its old category
                const newCategories = categories.map(cat => {
                    const siteIndex = cat.sites.findIndex(s => s.id.toString() === siteId.toString());
                    if (siteIndex > -1) {
                        movedSite = cat.sites[siteIndex];
                        return { ...cat, sites: cat.sites.filter(s => s.id.toString() !== siteId.toString()) };
                    }
                    return cat;
                });

                if (!movedSite) return;

                // 2. Add site to target category
                setCategories(newCategories.map(cat => {
                    if (cat.id === targetCategoryId) {
                        return { ...cat, sites: [...cat.sites, movedSite] };
                    }
                    return cat;
                }));
            };

            const handleDeleteSite = (siteId) => {
                if (!confirm('确定要删除这个规范吗？')) return;
                setCategories(prev => prev.map(cat => ({
                    ...cat,
                    sites: cat.sites.filter(s => s.id !== siteId)
                })));
            };

            // 编辑规范内容
            const handleEditSite = (siteId, updates) => {
                setCategories(prev => prev.map(cat => ({
                    ...cat,
                    sites: cat.sites.map(s =>
                        s.id === siteId ? { ...s, ...updates } : s
                    )
                })));
            };

            const handleUpdateCategoryTitle = (catId, newTitle) => {
                setCategories(prev => prev.map(cat =>
                    cat.id === catId ? { ...cat, title: newTitle } : cat
                ));
            };

            // 添加规范到分类
            const handleAddToCategory = (categoryId, selectedNorms) => {
                setCategories(prev => prev.map(cat => {
                    if (cat.id === categoryId) {
                        // 为每个规范生成唯一ID并转换为site格式，保留pdfUrl
                        const newSites = selectedNorms.map((norm, idx) => ({
                            id: `norm-${Date.now()}-${idx}`,
                            name: norm.name,
                            url: norm.url,
                            pdfUrl: norm.pdfUrl || null // 保留PDF链接
                        }));
                        return { ...cat, sites: [...cat.sites, ...newSites] };
                    }
                    return cat;
                }));
            };

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/30">

                    {/* Background decoration */}
                    <div className="absolute top-0 left-0 w-full h-64 bg-gradient-to-b from-blue-100/50 to-transparent -z-10"></div>

                    {/* Navbar */}
                    <nav className="w-full glass-panel shadow-sm sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16 items-center">
                                <div className="flex items-center gap-3">
                                    <img src="favicon.png" className="w-10 h-10 rounded-lg shadow-md" alt="搜建筑" />
                                    <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600">
                                        搜建筑导航
                                    </h1>
                                </div>
                                <div className="flex items-center gap-3">
                                    {/* 存档按钮组 */}
                                    <div className="hidden md:flex items-center gap-2 bg-white p-1 rounded-full border border-slate-200 shadow-sm">
                                        <button
                                            onClick={handleSaveArchive}
                                            className="flex items-center gap-1.5 px-3 py-1.5 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-full transition-all text-sm font-medium"
                                            title="保存当前数据为存档文件"
                                        >
                                            <i className="fa-solid fa-download"></i>
                                            保存存档
                                        </button>
                                        <div className="w-px h-4 bg-slate-200"></div>
                                        <label
                                            className="flex items-center gap-1.5 px-3 py-1.5 text-slate-600 hover:text-orange-600 hover:bg-orange-50 rounded-full transition-all text-sm font-medium cursor-pointer"
                                            title="从存档文件恢复数据"
                                        >
                                            <i className="fa-solid fa-upload"></i>
                                            恢复存档
                                            <input
                                                ref={restoreInputRef}
                                                type="file"
                                                accept=".json"
                                                onChange={handleRestoreArchive}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>

                                    <button
                                        onClick={() => setIsCatalogModalOpen(true)}
                                        className="hidden md:flex items-center gap-2 px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-full hover:bg-slate-50 hover:text-blue-600 hover:border-blue-200 transition-all text-sm font-medium shadow-sm hover:shadow"
                                    >
                                        <i className="fa-solid fa-table-list"></i>
                                        规范目录
                                    </button>

                                    <button
                                        onClick={() => setIsEditMode(!isEditMode)}
                                        className={`
                                            flex items-center gap-2 px-5 py-2 rounded-full text-sm font-medium transition-all shadow-md border
                                            ${isEditMode
                                                ? 'bg-white text-amber-600 border-amber-200 ring-2 ring-amber-100'
                                                : 'bg-white text-slate-700 border-slate-200 hover:bg-slate-50 hover:text-blue-600'}
                                        `}
                                    >
                                        <i className={`fa-solid ${isEditMode ? 'fa-check' : 'fa-pen-to-square'}`}></i>
                                        {isEditMode ? '完成编辑' : '编辑布局'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">

                        <div className="text-center mb-10 animate-fadeIn">
                            <h2 className="text-3xl sm:text-4xl font-extrabold text-slate-800 mb-4 tracking-tight">
                                建筑规范一站式查询
                            </h2>
                            <p className="text-slate-500 max-w-none md:max-w-6xl mx-auto text-lg md:whitespace-nowrap">
                                收录搜建筑网站的规范，支持快速检索、分类导航及<span className="text-blue-600 font-medium">上传本地PDF</span>进行统一管理与预览
                            </p>
                        </div>

                        <SearchBar />

                        {/* Mobile Catalog Button */}
                        <div className="md:hidden flex justify-center mb-8">
                            <button
                                onClick={() => setIsCatalogModalOpen(true)}
                                className="flex items-center gap-2 px-6 py-3 bg-white text-blue-600 border border-blue-100 rounded-xl hover:bg-blue-50 font-medium shadow-sm w-full max-w-xs justify-center"
                            >
                                <i className="fa-solid fa-table-list"></i>
                                规范目录查看添加
                            </button>
                        </div>

                        <div className="grid grid-cols-1 gap-6 pb-20">
                            {categories.map(category => (
                                <CategoryGroup
                                    key={category.id}
                                    category={category}
                                    isEditMode={isEditMode}
                                    onDrop={handleDropSite}
                                    onDeleteSite={handleDeleteSite}
                                    onEditSite={handleEditSite}
                                    onUpdateCategoryTitle={handleUpdateCategoryTitle}
                                    editingSiteId={editingSiteId}
                                    onSetEditingSiteId={setEditingSiteId}
                                />
                            ))}
                        </div>
                    </main>



                    {/* Modals */}
                    <CatalogViewerModal
                        isOpen={isCatalogModalOpen}
                        onClose={() => setIsCatalogModalOpen(false)}
                        categories={categories}
                        onAddToCategory={handleAddToCategory}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>